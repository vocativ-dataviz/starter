var colorScaleColors,data,developmentMode,numberFormat,uri,urlQuery,vizData,vizScale,vocCatScale;$(document).click(function(){return ga("Items","click-interactive","DESCRIPTION--OF--CLICK",1)}),vocCatScale=d3.scale.ordinal().range(["#FB514E","#2d82ca","#49af37","#9065c8"]),colorScaleColors=["#e6e6e6","#FF0000"],data=null,vizScale=null,developmentMode=null,numberFormat=d3.format("s"),uri=new URI(window.location),urlQuery=uri.search(!0),developmentMode="true"===urlQuery.development?!0:!1,$(window).load(function(){var t,e,o;return t=new pym.Child({polling:500}),e=void 0!==urlQuery.key?urlQuery.key:"1EpP7dXXGWKEb91uumBDgKBr5jHY0O4U6S4T37L88ua4",o=null,o=void 0===urlQuery.sheet?!0:!1,Tabletop.init({key:e,simpleSheet:o,callback:function(t){var e;return console.log("rawsheetdata",t),void 0!==urlQuery.sheet?(e=decodeURI(urlQuery.sheet),data=t[e].elements):data=t,vizData()}})}),vizData=function(){var t,e,o,a,r,l,n,i,s,d,c,u,p,v,f,m,g;return u="#content",t=$(u),console.log("Our data!",data,data[data.length-1]),g=t.width(),r=t.height(),m=900,g>649?(console.log(g," ==> Desktop"),c=!1,vizScale=m,i={left:16,right:16,top:16,bottom:16}):(console.log(g," ==> Mobile"),c=!0,vizScale=.4*m,i={left:2,right:2,top:8,bottom:8}),r=r-i.top-i.bottom,g=g-i.left-i.right,p={},f=void 0===urlQuery.metric?"atorbelowminimumwagepercapita":urlQuery.metric,data.forEach(function(t){return p[t.stateabbr]=t[f]}),console.log("we built stateData! ",p),d=d3.extent(d3.entries(data),function(t){return+t.value[f]}),s=d3.scale.linear().domain(d).range(colorScaleColors),developmentMode===!0&&(e=_.keys(data[0]),l=d3.select(u).append("select").attr("id","key-selector"),l.selectAll("option").data(e).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}).attr("selected",function(t){return void 0!==f&&t===f?"selected":void 0}),l.on("change",function(){return f=$(this).val(),console.log("changed to ",f),window.location.href=uri.setSearch("metric",f).toString()})),v=d3.select("#viz-svg").append("svg").attr({width:g+i.left+i.right,height:r+i.top+i.bottom,preserveAspectRatio:"xMidYMid",viewBox:"0 0 "+g+" "+r}),developmentMode===!0&&($("#viz-metric").text(f),v.append("text").text(f).attr({"font-size":9,fill:"#CCC",x:2}),v.style("border","1px solid #999")),v=v.append("g").attr("transform","translate(10,10)").attr("transform","translate("+i.left+","+i.top+")"),n=v.append("g").attr("class","viz-legend"),a="legend-gradient",o=n.append("defs").append("linearGradient").attr({id:a,x1:"0%",x2:"100%",y1:"0%",y2:"0%"}),o.append("stop").attr({"class":"stop1",offset:"0%","stop-color":colorScaleColors[0]}),o.append("stop").attr({"class":"stop2",offset:"100%","stop-color":colorScaleColors[1]}),n.append("rect").attr({fill:"url(#"+a+")",x:.15*g,y:-2,width:.69*g,height:20}),n.append("text").text(numberFormat(d[1])).attr({x:g-.15*g+6,y:14}).style("text-anchor","start"),n.append("text").text(numberFormat(d[0])).attr({x:.15*g-6,y:14}).style("text-anchor","end"),d3.json("data/USA.json",function(t){var e,o,a,l;return $("#content").css("background-image",""),l=topojson.feature(t,t.objects.usStates),o=d3.geo.albersUsa().scale(vizScale).translate([g/2,r/2]),e=d3.geo.path().projection(o),v.append("path").datum(l).attr("d",d3.geo.path().projection(o)),a=v.selectAll(".state").data(topojson.feature(t,t.objects.usStates).features).enter().append("path").attr("class",function(t){return"state "+t.properties.STATE_ABBR}).attr("id",function(t){return t.properties.STATE_ABBR}).attr("d",e).style("stroke","white").style("stroke-width",1).style("fill","white").style("fill",function(t){var e,o;return e=t.properties.STATE_ABBR,o=p[t.properties.STATE_ABBR],console.log("state!",e,o),void 0!==o?"x"===o?"red":"#CCC":void 0})})};